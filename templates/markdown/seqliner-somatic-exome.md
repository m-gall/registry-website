 Peter MacCallum Cancer Centre



#### General information
 * Paired tumour and normal samples
 * Whole exome libraries
 * Multiple lanes sequenced per individual
 * Since germline calls are not of interest,

#### Target definition
 * Some stages are limited to discovery across capture library, with a definition provided as a bed file. If exon intervals are required, they are defined as Refseq genes. The library preparation kit information is stored with the patient metadata.
 * Two bed inputs: Vespa.bed and annotated.bed.
 * vespa.bed: library capture sites provided by the kit provider
 * annotated.bed: list of genes as bed interval file - required for coverage calculations only.

#### Sample QC
 * PM has a separate pipeline for verifying sample mix-ups: tumour-normal pairs and patient identity compared
 * Based on comparison/similarity of snp signatures [number of reference snps: ]

#### FASTQ QC
 * Quality of the raw sequenced checked with _FastQC v0.11.5_ with default parameters. FastQC report is output as an .html (paired reads examined separately). Quality flags are based on default thresholds (see fastqc documentation) with metrics detecting common sequencing issues. Failure of a sample to meet a flag does not exclude the sample from further analyses. Report briefly evaluated by the bioinformatician but failure of a sample to meet quality flag would not operationally halt the pipeline.
 * Over-represented sequences output from fastqc are piped to cut-adapt in instances of adaptor contamination. This stage is run irrespective of the presence of adaptor contamination.

 * _Cutadapt_ run on paired-end samples flagged for adaptor contamination by FastQC. Quality trimming  15; Discard reads shorter than 50 bases.
 * Sequences identified as over-represented by fastqc are piped to cutadapt. Cutadapt is always run but procedure implemented will depend on the fastqc flag (extracts information from the fastqc.html).

#### Alignment/Assembly
 * 'Cleaned' adaptor-free reads are mapped to the reference genome using bwa version 0.7.10 with bwa-mem algorithm
 * Each lane is mapped to the reference genome separately (hg19.fasta) with secondary alignments (i.e. unpaired paired reads) flagged. Shorter split hits are marked as secondary.
 * Aligned read per lane are merged into a single bam using _Picard MergeSamFiles v2.6.0_.
 * Reads are sorted and indexed by genomic coordinates using _samtools_
 * Duplicates are marked over the merged samples using _Picard MarkDuplicates version 1.119_. Duplicate statistics calculated using _Picard MarkDuplicates_ are presented in the stage summary report.
 * Following de-duplication, tumor and normal samples are merged into single bam using _Picard v1.119 MergeSamFiles_.
 * Indel realignment: _GATK RealignerTargetCreator_ & _GATK IndelRealigner_. _GATK RealignerTargetCreator_ identifies indels in need of realignment (regions of high variation). Mills & Gold 1000g gold standard indels, 1000G_phase1_indels.hg19.vcf are used a reference set. A list of intervals to be realigned is output by _GATK RealignerTargetCreator_ and _GATK IndelRealigner_ performs realignment over these regions. Merge performed prior to indel realignment.
 * BSQR: _GATK BaseRecalibrator_. dbsnp_138.hg19.vcf used as a reference set. _GATK PrintReads_ updates QUAL fields with recalibrated values. Empirical values used for recalibration are calculated across read groups (@RGtags).
 * Following recalibration, separate tumor and normal samples are split into separate bam files with _GATK splitsamfile_.

#### BAM QC
 * gene and interval coverage: _GATK DepthOfCoverage_ and in-house script. Regions are defined by a bed file. Coverage is calculated across target lists, genes (as specified) and capture (library) sites. Output (.txt) goes to pathos.
 * Additional bam-related statistics are calculated and appended to the final VCF including metrics for: bidrectionality, ad, dp. Modifies metrics produced by the variant callers and applies additional strict filters. Additional metrics added to the file based on outputs produced by samtools.
 *

#### Variant Calling
 * Tumour and normal files same pipeline processing until the variant calling stages.
 * 3 tumour indel & snp variant packages implemented. Calling parallelised by chromosome.
 * Vardict currently under evaluation - highly sensitive and observed to generate a high number of false positives.
 * Outputs from each package are sent as separate files to the curation system (Pathos), where in-house filters are applied to prioritise/collapse calls across the packages

#### SNV & Indels 
 * Three variant calling packages are used to call SNV's and indels: _varscan v2.3.7_, _vardict v1.4.6_, _mutect2 v_.]
 * GATK HaplotypeCaller called over tumour vs normal samples. Somatic calls determined by PathOS.

 * _Varscan_: calls SNP's and indels from pileup generated by _samtools_ mpileup. Somatic and normal samples are called and stored separately as a vcf.
 * _Mutect2_ and _vardict_: vcf are called in parallel for each chromosome separately. Chromosomes are defined by a bed file which is a subset of the regions.bed file. Calling per chromosome allows parallel processing.
 * _vardict_: calls indel's and snv's. Variant calling is also performed over each chromosome separately. Variants are called for tumor and normal samples separately. Part of the vardict package but built as a separate stage: _vardict2vcf_somatic.pl_ performs a fisher exact test to determine statistical differences in allele frequency between the somatic vs normal sample. Calls are classed as germline if present in tumor and normal vs somatic if present in tumor only. The minimum allele frequency is 0.05. Minimum variant depth  3.
 * _GATK catVariants_ combines the chromosome calls per chromosome back to a single vcf.
 * _Mutect2_: indels & snv's. Joint statistics are calculated for tumor vs normal calls to assist discovery of true somatic calls. cosmic version 54 and dbsnp version 138 are used as reference datasets - improves confidence of a variant call as a somatic or germline call.

 * VCF version XX based on local cache.

#### Variant Annotation
 * _VEP version 78_.
 * Additional plug-ins: exac, catscore, evs and condel
 * Clinical annotations based on internal databases are added by Pathos.

#### Variant Filtering
 * in-house script

#### Pre-annotation filters 
 * vardict somatic filter: include only calls in vcf where status is 'Strong somatic' - in-house script incorporating _bcftools version 1.3.1_
 * remove low quality mutect2 calls: discard variants which are flagged as low quality based on mutect2 internal filters - in-house script incorporating _vcftools v.0.1.14_
 * allele depth (AD) and read depth (DP) calculations for each of the variant callers are combined: override with single value in the vcf: mean + SD for the 3 variant callers. This is a requirement for pathos (only accepts 1 value for these metrics).
 * _bedtools version 2.2.1_ intersect - by vespa.bed file

#### Post-annotation filters 
 * Handled by _Pathos_
 * VCF flattened to table and indexes applied

#### Variant QC
 * No variant recalibration performed
 * Variants of clinical interest are manually checked by curators prior to variant reporting

#### Verification/Validation
#### Curation
 * PathOS version XX.
 * Pre-processing of the annotated VCF is required prior to upload into Pathos, however, this is part of a separate pipeline.

#### Reporting
 * Most outputs providing metrics for sample quality are uploaded to Pathos directly

#### Packages - summary
||'''Stage''' ||'''Tools & version''' ||'''Data inputs''' ||
||Quality control ||FastQC 0.11.2, cutadapt v 1.5, GATK DepthOfCoverage, Picard MarkDuplicates v1.119 , bedtools v2.21 vcftools v0.1.14  bcftools v1.3.1 ||hg19.fasta, annotated.bed ||
||Mapping ||bwa-mem v0.7.10-r789 ||hg19.fasta ||
||Local realignment ||GATK RealignerTargetCreator, GATK IndelRealigner ||hg19.fasta, Mills&1000G indels, 1000G phase1 indels,  vespa.bed ||
||Base recalibration ||GATK Base recalibrator, GATK PrintReads ||hg19.fasta, dbSNP_137.b37.vcf, vespa.bed ||
||Variant calling ||Vardict v1.4.6, varscan v2.3.7, GATK mutect v3.6, GATK Haplotype caller v3.6 ||hg19.fasta, dbsnp_137.vcf, hg19.cosmic_v54.vcf ||
||Variant filtering ||addbamstats.pl ||hg19.fasta, dbSNP_137.vcf, vespa.bed ||
||Variant annotation ||VEP version 78 + plugins (condel, exac, catscore, evs || ||
||File manipulation ||gatk catvariants, gatk combinevariants ||hg19.fasta ||


Page Authors/Contributors: M. Gall (AGHA), Jason Li (Peter MacCallum Cancer Centre), Richard Lupat (Peter MacCallum Cancer Centre)
